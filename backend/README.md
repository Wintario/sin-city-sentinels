# Sin City Sentinels Backend

REST API –¥–ª—è —Å–∞–π—Ç–∞ –∫–ª–∞–Ω–∞ "–°–≤–∏—Ä–µ–ø—ã–µ –ö—Ä–æ–ª–∏–∫–∏" (Sin City Sentinels).

## üõ† –¢–µ—Ö–Ω–æ–ª–æ–≥–∏–∏

- **Node.js** + **Express** ‚Äî –≤–µ–±-—Å–µ—Ä–≤–µ—Ä
- **SQLite** (better-sqlite3) ‚Äî –±–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö
- **bcrypt** ‚Äî —Ö–µ—à–∏—Ä–æ–≤–∞–Ω–∏–µ –ø–∞—Ä–æ–ª–µ–π
- **jsonwebtoken** ‚Äî JWT –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è
- **helmet** ‚Äî HTTP –∑–∞–≥–æ–ª–æ–≤–∫–∏ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏
- **express-rate-limit** ‚Äî –∑–∞—â–∏—Ç–∞ –æ—Ç –±—Ä—É—Ç—Ñ–æ—Ä—Å–∞

## üìÅ –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø—Ä–æ–µ–∫—Ç–∞

```
backend/
‚îú‚îÄ‚îÄ server.js                    # –ì–ª–∞–≤–Ω—ã–π —Ñ–∞–π–ª —Å–µ—Ä–≤–µ—Ä–∞
‚îú‚îÄ‚îÄ .env.example                 # –ü—Ä–∏–º–µ—Ä –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö –æ–∫—Ä—É–∂–µ–Ω–∏—è
‚îú‚îÄ‚îÄ package.json
‚îú‚îÄ‚îÄ src/
‚îÇ   ‚îú‚îÄ‚îÄ config/
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ config.js            # –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
‚îÇ   ‚îú‚îÄ‚îÄ db/
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ db.js                # –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è SQLite
‚îÇ   ‚îú‚îÄ‚îÄ models/
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ user.js              # –û–ø–µ—Ä–∞—Ü–∏–∏ —Å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º–∏
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ news.js              # –û–ø–µ—Ä–∞—Ü–∏–∏ —Å –Ω–æ–≤–æ—Å—Ç—è–º–∏
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ members.js           # –û–ø–µ—Ä–∞—Ü–∏–∏ —Å —É—á–∞—Å—Ç–Ω–∏–∫–∞–º–∏
‚îÇ   ‚îú‚îÄ‚îÄ middleware/
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ auth.js              # JWT –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ errorHandler.js      # –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ validate.js          # –í–∞–ª–∏–¥–∞—Ü–∏—è –¥–∞–Ω–Ω—ã—Ö
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ rateLimiter.js       # Rate limiting
‚îÇ   ‚îú‚îÄ‚îÄ controllers/
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ authController.js    # –õ–æ–≥–∏–∫–∞ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ newsController.js    # –õ–æ–≥–∏–∫–∞ –Ω–æ–≤–æ—Å—Ç–µ–π
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ membersController.js # –õ–æ–≥–∏–∫–∞ —É—á–∞—Å—Ç–Ω–∏–∫–æ–≤
‚îÇ   ‚îî‚îÄ‚îÄ routes/
‚îÇ       ‚îú‚îÄ‚îÄ authRoutes.js        # –ú–∞—Ä—à—Ä—É—Ç—ã –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏
‚îÇ       ‚îú‚îÄ‚îÄ newsRoutes.js        # –ú–∞—Ä—à—Ä—É—Ç—ã –Ω–æ–≤–æ—Å—Ç–µ–π
‚îÇ       ‚îî‚îÄ‚îÄ membersRoutes.js     # –ú–∞—Ä—à—Ä—É—Ç—ã —É—á–∞—Å—Ç–Ω–∏–∫–æ–≤
‚îú‚îÄ‚îÄ scripts/
‚îÇ   ‚îî‚îÄ‚îÄ migrate.js               # –ú–∏–≥—Ä–∞—Ü–∏—è –ë–î
‚îî‚îÄ‚îÄ data/
    ‚îî‚îÄ‚îÄ app.db                   # SQLite –±–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö (—Å–æ–∑–¥–∞—ë—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏)
```

## üöÄ –ë—ã—Å—Ç—Ä—ã–π —Å—Ç–∞—Ä—Ç

### 1. –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π

```bash
cd /var/www/rabbits/backend
npm install
```

### 2. –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –æ–∫—Ä—É–∂–µ–Ω–∏—è

```bash
cp .env.example .env
```

–û—Ç—Ä–µ–¥–∞–∫—Ç–∏—Ä—É–π `.env`:
```env
NODE_ENV=production
PORT=3000
DB_PATH=./data/app.db
JWT_SECRET=—Ç–≤–æ–π_–æ—á–µ–Ω—å_–¥–ª–∏–Ω–Ω—ã–π_—Å–µ–∫—Ä–µ—Ç–Ω—ã–π_–∫–ª—é—á_–º–∏–Ω–∏–º—É–º_32_—Å–∏–º–≤–æ–ª–∞
CORS_ORIGIN=https://—Ç–≤–æ–π-–¥–æ–º–µ–Ω.ru
```

### 3. –ú–∏–≥—Ä–∞—Ü–∏—è –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö

```bash
npm run migrate
```

–≠—Ç–æ —Å–æ–∑–¥–∞—Å—Ç:
- –¢–∞–±–ª–∏—Ü—ã `users`, `news`, `members`
- –î–µ—Ñ–æ–ª—Ç–Ω—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π (admin/admin, author/author)
- –ù–∞—á–∞–ª—å–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ

### 4. –ó–∞–ø—É—Å–∫

**–î–ª—è —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏:**
```bash
npm run dev
```

**–î–ª—è production (—á–µ—Ä–µ–∑ PM2):**
```bash
# –£—Å—Ç–∞–Ω–æ–≤–∏ PM2 –≥–ª–æ–±–∞–ª—å–Ω–æ
sudo npm install -g pm2

# –ó–∞–ø—É—Å—Ç–∏ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ
pm2 start server.js --name rabbits-backend

# –°–æ—Ö—Ä–∞–Ω–∏ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é
pm2 save
pm2 startup
```

### 5. –ü—Ä–æ–≤–µ—Ä–∫–∞

```bash
curl http://localhost:3000/health
# {"status":"ok","timestamp":"...","service":"Sin City Sentinels API"}
```

## üîê API –≠–Ω–¥–ø–æ–∏–Ω—Ç—ã

### –ê–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è

| –ú–µ—Ç–æ–¥ | –ü—É—Ç—å | –û–ø–∏—Å–∞–Ω–∏–µ |
|-------|------|----------|
| POST | `/api/auth/login` | –í—Ö–æ–¥ (username, password) |
| GET | `/api/auth/me` | –¢–µ–∫—É—â–∏–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å (—Ç—Ä–µ–±—É–µ—Ç —Ç–æ–∫–µ–Ω) |
| POST | `/api/auth/verify` | –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ç–æ–∫–µ–Ω–∞ |

### –ù–æ–≤–æ—Å—Ç–∏

| –ú–µ—Ç–æ–¥ | –ü—É—Ç—å | –î–æ—Å—Ç—É–ø | –û–ø–∏—Å–∞–Ω–∏–µ |
|-------|------|--------|----------|
| GET | `/api/news` | –ü—É–±–ª–∏—á–Ω—ã–π | –í—Å–µ –æ–ø—É–±–ª–∏–∫–æ–≤–∞–Ω–Ω—ã–µ –Ω–æ–≤–æ—Å—Ç–∏ |
| GET | `/api/news/:id` | –ü—É–±–ª–∏—á–Ω—ã–π | –û–¥–Ω–∞ –æ–ø—É–±–ª–∏–∫–æ–≤–∞–Ω–Ω–∞—è –Ω–æ–≤–æ—Å—Ç—å |
| GET | `/api/news/admin/list` | –ê–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω–Ω—ã–π | –í—Å–µ –Ω–æ–≤–æ—Å—Ç–∏ (–¥–ª—è –∞–¥–º–∏–Ω–∫–∏) |
| POST | `/api/news` | –ê–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω–Ω—ã–π | –°–æ–∑–¥–∞—Ç—å –Ω–æ–≤–æ—Å—Ç—å |
| PUT | `/api/news/:id` | –ê–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω–Ω—ã–π | –û–±–Ω–æ–≤–∏—Ç—å –Ω–æ–≤–æ—Å—Ç—å |
| DELETE | `/api/news/:id` | –ê–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω–Ω—ã–π | –£–¥–∞–ª–∏—Ç—å –Ω–æ–≤–æ—Å—Ç—å (–º—è–≥–∫–æ–µ) |
| PATCH | `/api/news/:id/restore` | –¢–æ–ª—å–∫–æ admin | –í–æ—Å—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –Ω–æ–≤–æ—Å—Ç—å |

### –£—á–∞—Å—Ç–Ω–∏–∫–∏

| –ú–µ—Ç–æ–¥ | –ü—É—Ç—å | –î–æ—Å—Ç—É–ø | –û–ø–∏—Å–∞–Ω–∏–µ |
|-------|------|--------|----------|
| GET | `/api/members` | –ü—É–±–ª–∏—á–Ω—ã–π | –í—Å–µ –∞–∫—Ç–∏–≤–Ω—ã–µ —É—á–∞—Å—Ç–Ω–∏–∫–∏ |
| GET | `/api/members/:id` | –ü—É–±–ª–∏—á–Ω—ã–π | –û–¥–∏–Ω —É—á–∞—Å—Ç–Ω–∏–∫ |
| GET | `/api/members/admin/list` | –ê–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω–Ω—ã–π | –í—Å–µ —É—á–∞—Å—Ç–Ω–∏–∫–∏ (–¥–ª—è –∞–¥–º–∏–Ω–∫–∏) |
| POST | `/api/members` | –ê–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω–Ω—ã–π | –°–æ–∑–¥–∞—Ç—å —É—á–∞—Å—Ç–Ω–∏–∫–∞ |
| PUT | `/api/members/:id` | –ê–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω–Ω—ã–π | –û–±–Ω–æ–≤–∏—Ç—å —É—á–∞—Å—Ç–Ω–∏–∫–∞ |
| DELETE | `/api/members/:id` | –ê–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω–Ω—ã–π | –£–¥–∞–ª–∏—Ç—å —É—á–∞—Å—Ç–Ω–∏–∫–∞ |
| PATCH | `/api/members/:id/reorder` | –ê–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω–Ω—ã–π | –ò–∑–º–µ–Ω–∏—Ç—å –ø–æ—Ä—è–¥–æ–∫ |

## üîë –ê—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è

–î–ª—è –∑–∞—â–∏—â—ë–Ω–Ω—ã—Ö —ç–Ω–¥–ø–æ–∏–Ω—Ç–æ–≤ –¥–æ–±–∞–≤—å –∑–∞–≥–æ–ª–æ–≤–æ–∫:

```
Authorization: Bearer <token>
```

–ü—Ä–∏–º–µ—Ä –ø–æ–ª—É—á–µ–Ω–∏—è —Ç–æ–∫–µ–Ω–∞:
```bash
curl -X POST http://localhost:3000/api/auth/login \
  -H "Content-Type: application/json" \
  -d '{"username":"admin","password":"admin"}'
```

## üõ° –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å

- **bcrypt** ‚Äî –≤—Å–µ –ø–∞—Ä–æ–ª–∏ —Ö–µ—à–∏—Ä—É—é—Ç—Å—è
- **JWT** ‚Äî stateless –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è
- **Rate limiting** ‚Äî –∑–∞—â–∏—Ç–∞ –æ—Ç –±—Ä—É—Ç—Ñ–æ—Ä—Å–∞ (5 –ø–æ–ø—ã—Ç–æ–∫ –≤—Ö–æ–¥–∞ –≤ –º–∏–Ω—É—Ç—É)
- **Helmet** ‚Äî –±–µ–∑–æ–ø–∞—Å–Ω—ã–µ HTTP –∑–∞–≥–æ–ª–æ–≤–∫–∏
- **–í–∞–ª–∏–¥–∞—Ü–∏—è** ‚Äî –≤—Å–µ –≤—Ö–æ–¥–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ –ø—Ä–æ–≤–µ—Ä—è—é—Ç—Å—è
- **–†–æ–ª–∏** ‚Äî admin –∏ author —Å —Ä–∞–∑–Ω—ã–º–∏ –ø—Ä–∞–≤–∞–º–∏

## üìù –î–µ—Ñ–æ–ª—Ç–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ

–ü–æ—Å–ª–µ –º–∏–≥—Ä–∞—Ü–∏–∏ —Å–æ–∑–¥–∞—é—Ç—Å—è:

**–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏:**
- `admin` / `admin` (—Ä–æ–ª—å: admin)
- `author` / `author` (—Ä–æ–ª—å: author)

‚ö†Ô∏è **–í–ê–ñ–ù–û:** –°–º–µ–Ω–∏ –ø–∞—Ä–æ–ª–∏ –ø–æ—Å–ª–µ –ø–µ—Ä–≤–æ–≥–æ –≤—Ö–æ–¥–∞!

**–£—á–∞—Å—Ç–Ω–∏–∫–∏:**
- –ª–µ–≥–∏–æ–Ω86 (–ì–ª–∞–≤–∞ –∫–ª–∞–Ω–∞) ‚Äî —Å —Å—Å—ã–ª–∫–æ–π –Ω–∞ –ø—Ä–æ—Ñ–∏–ª—å
- –†–µ–π–¥–µ—Ä (–û—Ñ–∏—Ü–µ—Ä)
- –¢–µ–Ω—å (–í–µ—Ç–µ—Ä–∞–Ω)
- –ö–ª—ã–∫ (–ë–æ–µ—Ü)
- –®—Ç–æ—Ä–º (–ë–æ–µ—Ü)

## üîß –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è Nginx

```nginx
server {
    listen 80;
    server_name —Ç–≤–æ–π-–¥–æ–º–µ–Ω.ru;
    
    # –°—Ç–∞—Ç–∏–∫–∞ (React build)
    root /var/www/rabbits/frontend/dist;
    index index.html;
    
    # SPA —Ä–æ—É—Ç–∏–Ω–≥
    location / {
        try_files $uri $uri/ /index.html;
    }
    
    # API –ø—Ä–æ–∫—Å–∏—Ä–æ–≤–∞–Ω–∏–µ
    location /api {
        proxy_pass http://127.0.0.1:3000;
        proxy_http_version 1.1;
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
        proxy_set_header X-Forwarded-Proto $scheme;
    }
    
    # Health check
    location /health {
        proxy_pass http://127.0.0.1:3000;
    }
}
```

## üìû –ü—Ä–∏–º–µ—Ä—ã –∑–∞–ø—Ä–æ—Å–æ–≤

### –õ–æ–≥–∏–Ω
```bash
curl -X POST http://localhost:3000/api/auth/login \
  -H "Content-Type: application/json" \
  -d '{"username":"admin","password":"admin"}'
```

### –ü–æ–ª—É—á–∏—Ç—å –Ω–æ–≤–æ—Å—Ç–∏
```bash
curl http://localhost:3000/api/news
```

### –°–æ–∑–¥–∞—Ç—å –Ω–æ–≤–æ—Å—Ç—å (—Ç—Ä–µ–±—É–µ—Ç —Ç–æ–∫–µ–Ω)
```bash
curl -X POST http://localhost:3000/api/news \
  -H "Content-Type: application/json" \
  -H "Authorization: Bearer <token>" \
  -d '{
    "title": "–ù–æ–≤–∞—è –Ω–æ–≤–æ—Å—Ç—å",
    "content": "–¢–µ–∫—Å—Ç –Ω–æ–≤–æ—Å—Ç–∏...",
    "excerpt": "–ö—Ä–∞—Ç–∫–æ–µ –æ–ø–∏—Å–∞–Ω–∏–µ",
    "published_at": "2025-12-09T12:00:00Z"
  }'
```

---

üê∞ **Sin City Sentinels** ‚Äî –ú—ã –≤–µ–ª–∏—á–∞–π—à–∏–µ. –ú—ã –±–æ–≥–∏.
